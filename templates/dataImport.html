{% extends "base.html" %}

{% block title %}NHRI - 臨床研究數據平台{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='Content/css/dataImport.css') }}">
{% endblock %}

{% block content %}
<!-- <section class="welcome">
  <h2>歡迎來到健康資料平台</h2>
  <p>探索病人的健康事件與醫療資訊。</p>
</section> -->

<section>
  <div class="mx-auto max-w-3xl fade-in"><div class="mb-8 text-center">
    <h2 class="text-2xl font-bold text-slate-900">數據匯入與 ETL</h2>
    <p class="text-sm text-slate-500">將臨床數據或問卷資料匯入至資料庫</p>
  </div>
  <div class="mb-8 flex items-center justify-center">
    <!-- 這是上面的 123  -->
    <div class="flex items-center">
      <div class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-bold bg-blue-600 text-white" id="step-circle-1">1</div>
      <div class="mx-2 h-1 w-16 rounded-full bg-slate-200" id="step-line-1"></div>
      <div class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-bold bg-slate-200 text-slate-500" id="step-circle-2">2</div>
      <div class="mx-2 h-1 w-16 rounded-full bg-slate-200"  id="step-line-2"></div>
      <div class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-bold bg-slate-200 text-slate-500" id="step-circle-3">3</div>
    </div>
  </div>
  
  <div class="rounded-xl border border-slate-200 bg-white p-8 shadow-sm step-2-content">

    <!-- 這一整個是step1? -->
    <div class="space-y-6" id="step-1-content">
      <div class="text-center">
        <h3 class="text-lg font-bold text-slate-900">步驟 1：選擇資料來源類型</h3>
        <p class="mt-1 text-sm text-slate-500">請根據您要上傳的數據類型，選擇正確的對應接口，系統將自動套用對應的驗證規則。</p>
      </div>
      <div class="grid gap-4 md:grid-cols-3">

        <button onclick="goToStep2('FHIR')" class="flex flex-col items-center gap-3 rounded-xl border border-slate-200 p-6 transition-all hover:border-blue-500 hover:bg-blue-50 hover:shadow-md">
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-blue-100 p-3 text-blue-600">
            <i class="bi bi-file-earmark-text text-2xl"></i>
          </div>
          <span class="font-medium text-slate-700">醫院 FHIR</span>
          <span class="text-xs text-slate-400">JSON 格式</span>
        </button>

        <button  onclick="goToStep2('Excel')" class="flex flex-col items-center gap-3 rounded-xl border border-slate-200 p-6 transition-all hover:border-emerald-500 hover:bg-emerald-50 hover:shadow-md">
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-emerald-100 p-3 text-emerald-600">
            <i class="bi bi-activity text-2xl"></i>
          </div>
          <span class="font-medium text-slate-700">問卷 Excel</span>
          <span class="text-xs text-slate-400">CSV / XLSX 格式</span>
        </button>

        <button  onclick="goToStep2('Watch')" class="flex flex-col items-center gap-3 rounded-xl border border-slate-200 p-6 transition-all hover:border-purple-500 hover:bg-purple-50 hover:shadow-md">
          <div class="flex h-14 w-14 items-center justify-center rounded-full bg-purple-100 p-3 text-purple-600">
            <i class="bi bi-watch text-2xl"></i>
          </div>
          <span class="font-medium text-slate-700">ASUS Cloud</span>
          <span class="text-xs text-slate-400">API 同步 / JSON</span>
        </button>
      </div>
    </div>

    <!-- step2? -->
    <div class="space-y-6 text-center hidden" id="step-2-content">
      <div>
        <h3 class="text-lg font-bold text-slate-900">步驟 2：上傳檔案</h3>
        <p class="mt-1 text-sm text-slate-500">請確認檔案編碼為 UTF-8，且欄位名稱符合規格書定義 (最大支援 50MB)。</p>
        <p class="mt-1 text-sm text-slate-500" id="file-info-text">檔案說明</p>
      </div>
      <input type="text" id="type-hidden" name="type-hidden" class="hidden" />
      <label 
        for="file-upload" 
        id="drop-zone"
        class="flex min-h-[200px] cursor-pointer flex-col items-center justify-center rounded-xl border-2 border-dashed border-slate-300 bg-slate-50 p-6 transition-all hover:border-blue-400 hover:bg-blue-50 group"
      >
        <input type="file" id="file-upload" name="file" class="hidden" accept=".json,.csv,.xlsx" />
        

        <i class="bi bi-upload p-2 text-5xl text-slate-400 group-hover:text-blue-500 transition-colors"></i>
        
        <p id="file-status-text" class="mb-2 text-sm font-medium text-slate-700">
          點擊上傳或將檔案拖曳至此
        </p>
        
        <p class="text-xs text-slate-400">
          支援格式：<span id="format-hint">.json, .csv, .xlsx</span>
        </p>
      </label>
      <div class="flex justify-end gap-3">
        <button onclick="goToStep1()" class="rounded-lg px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100">上一步</button>
        <button onclick="handleUpload()" class="flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 disabled:opacity-50">開始驗證與匯入</button>
      </div>
    </div>


    <!-- Step3? -->
    <div class="space-y-6 text-center hidden" id="step-3-content">
      上傳成功
    </div>
  </div>

  


</div>

</section>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='Scripts/d3js-7.9.0.js') }}">
</script>
<script>
  
</script>
<script src="{{ url_for('static', filename='Content/Scripts/dataImport.js') }}">
</script>
{% endblock %}
